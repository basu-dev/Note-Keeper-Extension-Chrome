"use strict";const d=document,htmlParser=new DOMParser;let notes=[],firstPage,secondPage,firstPageCloseBtn,secondPageCloseBtn,backupBtn,textarea;d.addEventListener("DOMContentLoaded",()=>{firstPage=d.querySelector(".first-page"),secondPage=d.querySelector(".second-page"),firstPageCloseBtn=d.querySelector("#open-notes"),secondPageCloseBtn=d.querySelector("#second-page-close"),backupBtn=d.querySelector("#backup"),textarea=d.querySelector("textarea"),backupBtn.addEventListener("click",_=>backupNotes()),firstPageCloseBtn.addEventListener("click",_=>showFirstPage(!1)),secondPageCloseBtn.addEventListener("click",_=>showFirstPage(!0)),fillTextarea(),textarea.addEventListener("keyup",e=>{let data={};data[key]=e.target.value,chrome.storage.sync.set(data,res=>{console.log(res)})})});const fillTextarea=()=>{let key="";chrome.tabs.query({currentWindow:!0,active:!0},(function(tabs){key="Notes "+getUrlOrigin(tabs[0].url),chrome.storage.sync.get(key,data=>{data[key]&&(textarea.value=data[key])})}))},getUrlOrigin=string=>{let url;return new URL(string).origin},getNotes=()=>(notes=[],chrome.storage.sync.get(null,data=>{Object.keys(data).forEach(key=>{let note={url:/Notes (.+)/.exec(key)[1],note:data[key]};notes.push(note)}),showNotes(notes)}),notes),deleteAllNotes=_=>{chrome.storage.sync.get(null,data=>{Object.keys(data).forEach(key=>deleteNote(key))})},deleteNote=key=>{/^Notes .+$/.test(key)&&chrome.storage.sync.remove(key,data=>{console.log("deleting",data)})},showNotes=notes=>{let noteCards=d.querySelector(".cards");noteCards.innerHTML="";for(let i=0;i<notes.length;i++){let note=notes[i],html=htmlParser.parseFromString(`\n            <div class="card">\n                <div class="card-title">${note.url}<button>Del</button></div>\n                <div class="card-body">${note.note}</div>\n            </div>\n        `,"text/html").querySelector(".card");noteCards.appendChild(html)}},showFirstPage=truth=>{if(truth)firstPage.style.display="grid",secondPage.style.display="none";else{let notes=getNotes();showNotes(notes),firstPage.style.display="none",secondPage.style.display="grid"}},backupNotes=()=>{let a=d.createElement("a"),dt=new Date;a.setAttribute("download",`NotesBackup-${dt.getFullYear()}-${dt.getMonth()}-${dt.getDate()}-${dt.getHours()}-${dt.getMinutes()}.json`),a.href=`data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(notes))}`,a.style.display="none",d.body.append(a),console.log(a),a.click(),d.querySelector("[download]").remove()};